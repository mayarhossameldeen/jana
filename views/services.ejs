<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head') %>
  <body>
    <%- include('partials/nav') %>
    <br /><br /><br />

    <!-- Hero Section -->
    <div class="services-hero">
      <div class="hero-overlay"></div>
      <div class="container position-relative">
        <div class="row min-vh-50 align-items-center">
          <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-3 fw-bold mb-4 text-white hero-title">
              Welcome to our services
            </h1>
            <p class="lead mb-5 text-white hero-subtitle">
              Experience luxury beauty services in the comfort of your home. Our
              expert team brings professional care to your doorstep with
              flexible scheduling and personalized attention.
            </p>
            <div class="hero-buttons">
              <button
                type="button"
                class="btn btn-custom btn-lg me-3"
                data-bs-toggle="modal"
                data-bs-target="#calendarModal"
              >
                Book Now
              </button>
              <button class="btn btn-outline-light btn-lg">Learn More</button>
            </div>
            <div class="hero-features mt-5">
              <div class="row g-4">
                <div class="col-md-4">
                  <div class="feature-item">
                    <i
                      class="fas fa-star fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <h5 class="text-white">Premium Services</h5>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="feature-item">
                    <i
                      class="fas fa-clock fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <h5 class="text-white">Flexible Hours</h5>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="feature-item">
                    <i
                      class="fas fa-award fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <h5 class="text-white">Expert Staff</h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Services Categories -->
    <div class="container py-5">
      <div class="row g-4">
        <% if (services && services.length > 0) { %> <%
        services.forEach(function(service) { %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 border-0 shadow-sm">
            <img
              src="<%= service.image || '/images/default-service.jpg' %>"
              class="card-img-top"
              alt="<%= service.name %>"
            />
            <div class="card-body text-center p-4">
              <h3 class="card-title h4 mb-3" style="color: var(--text-color)">
                <%= service.name %>
              </h3>
              <p class="mb-2" style="color: var(--light-text)">
                <%= service.category %>
              </p>
              <p class="mb-2" style="color: var(--light-text)">
                <%= service.description %>
              </p>
              <p
                class="mb-2"
                style="color: var(--primary-pink); font-weight: bold"
              >
                EGP <%= service.price %> | <%= service.duration %> min
              </p>
              <% if (user) { %>
              <button
                type="button"
                class="btn btn-custom mt-3"
                data-bs-toggle="modal"
                data-bs-target="#bookingModal"
                data-service-id="<%= service._id %>"
                data-service-name="<%= service.name %>"
              >
                Book Now
              </button>
              <% } else { %>
              <button
                type="button"
                class="btn btn-custom mt-3 login-to-book-btn"
                data-bs-toggle="modal"
                data-bs-target="#loginModal"
              >
                Login to Book
              </button>
              <% } %>
            </div>
          </div>
        </div>
        <% }); %> <% } else { %>
        <div class="col-12 text-center">
          <p style="color: var(--light-text)">
            No services available at the moment.
          </p>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Why Choose Us Section -->
    <div class="container py-5">
      <div class="row">
        <div class="col-12 text-center mb-5">
          <h2 class="display-5" style="color: var(--primary-pink)">
            Why Choose Us
          </h2>
          <p class="lead" style="color: var(--text-color)">
            Experience the difference with our premium services
          </p>
        </div>
      </div>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="text-center">
            <i
              class="fas fa-certificate fa-3x mb-3"
              style="color: var(--primary-pink)"
            ></i>
            <h4 style="color: var(--text-color)">Expert Professionals</h4>
            <p style="color: var(--light-text)">
              Our team consists of highly trained and experienced beauty
              professionals
            </p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="text-center">
            <i
              class="fas fa-gem fa-3x mb-3"
              style="color: var(--primary-pink)"
            ></i>
            <h4 style="color: var(--text-color)">Premium Products</h4>
            <p style="color: var(--light-text)">
              We use only the highest quality products for all our services
            </p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="text-center">
            <i
              class="fas fa-heart fa-3x mb-3"
              style="color: var(--primary-pink)"
            ></i>
            <h4 style="color: var(--text-color)">Personalized Care</h4>
            <p style="color: var(--light-text)">
              Each service is tailored to meet your individual needs and
              preferences
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA Section -->
    <div
      class="container-fluid py-5"
      style="
        background: linear-gradient(
          135deg,
          var(--cream) 0%,
          var(--lavender) 100%
        );
      "
    >
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-8 text-center text-lg-start">
            <h2 class="display-5 mb-3" style="color: var(--primary-pink)">
              Ready to Experience Luxury?
            </h2>
            <p class="lead mb-0" style="color: var(--text-color)">
              Book your appointment today and transform your beauty routine
            </p>
          </div>
          <div class="col-lg-4 text-center text-lg-end mt-4 mt-lg-0">
            <button
              type="button"
              class="btn btn-custom btn-lg"
              data-bs-toggle="modal"
              data-bs-target="#calendarModal"
            >
              Book Appointment
            </button>
          </div>
        </div>
      </div>
    </div>

    <style>
      .services-hero {
        background: url("/images/background.jpg") center/cover no-repeat;
        position: relative;
        padding: 120px 0;
        margin-bottom: 50px;
      }
      .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(243, 119, 181, 0.6),
          rgba(230, 230, 250, 0.6)
        );
      }
      .hero-title {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        animation: fadeInDown 1s ease;
      }
      .hero-subtitle {
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        animation: fadeInUp 1s ease;
      }
      .hero-buttons {
        animation: fadeIn 1.5s ease;
      }
      .hero-features {
        animation: fadeInUp 2s ease;
      }
      .feature-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        transition: transform 0.3s ease;
      }
      .feature-item:hover {
        transform: translateY(-5px);
      }
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .btn-outline-light {
        border: 2px solid white;
        color: white;
        transition: all 0.3s ease;
      }
      .btn-outline-light:hover {
        background: white;
        color: var(--primary-pink);
      }
      .service-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(255, 105, 180, 0.1);
      }
      .card {
        transition: transform 0.3s ease;
      }
      .card:hover {
        transform: translateY(-10px);
      }
      .btn-custom {
        background: linear-gradient(
          45deg,
          var(--primary-pink),
          var(--rose-gold)
        );
        border: none;
        color: white;
        padding: 10px 25px;
        border-radius: 25px;
        transition: all 0.3s ease;
      }
      .btn-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        color: white;
      }
      .card-img-top {
        height: 300px;
        object-fit: contain;
        border-top-left-radius: 0.375rem;
        border-top-right-radius: 0.375rem;
      }
    </style>

    <%- include('partials/footer') %>

    <!-- Add the modal at the end of the file if not present -->
    <div
      class="modal fade"
      id="calendarModal"
      tabindex="-1"
      aria-labelledby="calendarModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="calendarModalLabel">
              Book Your Appointment
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body text-center">
            <label for="appointmentDate" class="form-label mb-2"
              >Select a date:</label
            >
            <input
              type="date"
              id="appointmentDate"
              class="form-control mb-3"
              style="max-width: 250px; margin: 0 auto"
            />
            <button
              class="btn btn-custom"
              onclick="alert('Appointment booked for ' + document.getElementById('appointmentDate').value)"
            >
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Modal -->
    <div
      class="modal fade"
      id="bookingModal"
      tabindex="-1"
      aria-labelledby="bookingModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="bookingForm">
            <div class="modal-header">
              <h5 class="modal-title" id="bookingModalLabel">Book Service</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="serviceId" name="serviceId" />
              <input type="hidden" id="customerId" name="customerId" value="<%= user ? user._id : '' %>" />
              <div class="mb-3">
                <label for="serviceName" class="form-label">Service</label>
                <input
                  type="text"
                  class="form-control"
                  id="serviceName"
                  name="serviceName"
                  readonly
                />
              </div>
              <div class="mb-3">
                <label for="date" class="form-label">Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="date"
                  name="date"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="time" class="form-label">Time</label>
                <input
                  type="time"
                  class="form-control"
                  id="time"
                  name="time"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="notes" class="form-label">Notes (optional)</label>
                <textarea
                  class="form-control"
                  id="notes"
                  name="notes"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-custom">Book</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div
      class="modal fade"
      id="loginModal"
      tabindex="-1"
      aria-labelledby="loginModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="loginForm">
            <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">Login</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="loginEmail" class="form-label">Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="loginEmail"
                  name="email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="loginPassword" class="form-label">Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="loginPassword"
                  name="password"
                  required
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-custom">Login</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Fill modal with service info
      var bookingModal = document.getElementById("bookingModal");
      bookingModal.addEventListener("show.bs.modal", function (event) {
        var button = event.relatedTarget;
        var serviceId = button.getAttribute("data-service-id");
        var serviceName = button.getAttribute("data-service-name");
        document.getElementById("serviceId").value = serviceId;
        document.getElementById("serviceName").value = serviceName;
      });

      // Handle booking form submit
      const bookingForm = document.getElementById("bookingForm");
      bookingForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const serviceId = document.getElementById("serviceId").value;
        const customerId = document.getElementById("customerId").value;
        const date = document.getElementById("date").value;
        const time = document.getElementById("time").value;
        const notes = document.getElementById("notes").value;
        try {
          const res = await fetch("/api/bookings", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              service: serviceId,
              customer: customerId,
              date,
              time,
              notes,
            }),
          });
          if (res.ok) {
            alert("Booking successful!");
            bookingForm.reset();
            var modal = bootstrap.Modal.getInstance(bookingModal);
            modal.hide();
          } else {
            const data = await res.json();
            alert("Booking failed: " + (data.error || "Please try again."));
          }
        } catch (err) {
          alert("Booking failed: " + err.message);
        }
      });

      // Optionally, focus the email input when login modal is shown
      const loginModal = document.getElementById('loginModal');
      if (loginModal) {
        loginModal.addEventListener('shown.bs.modal', function () {
          const emailInput = document.getElementById('loginEmail');
          if (emailInput) emailInput.focus();
        });
      }
    </script>
  </body>
</html>
